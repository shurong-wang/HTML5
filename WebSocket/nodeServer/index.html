<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link rel="icon" sizes="32x32" type="image/png" href="favicon.png">
	<title>WebSocket</title>
	<style>
		#box {width: 100px; height: 100px; background: red; position: absolute; left: 12px; top: 120px;}
	</style>
	<script src="client.socket.js"></script>
</head>
<body>
	<h1>Hello, WebSocket.</h1>
	<button id="btn">发送socket请求</button>
	<div id="box"></div>

	<script>
		window.onload = function() {
			var oBtn = document.getElementById('btn');
			var oDiv = document.getElementById('box');
			var socket = null;
			
			// 发送消息
			oBtn.onclick = function() {
				// 建立连接
				socket = io.connect('http://127.0.0.1:8888');

				// 监听响应
				socket.on('Event-01', function(data) {
					alert(data);
					// 发送事件
					this.emit('Event-02', '群主，什么时候抢红包？');
				});
				socket.on('Event-02', function(data) {
					alert(data);
				});
                socket.on('Event-00', function(data) {
                    alert(data);
                });
				socket.on('AllMove', function(data) {
					oDiv.style.left = data.left + 'px';
					oDiv.style.top = data.top + 'px';
				});
			}
			
			// 画面同步
			oDiv.onmousedown = function(ev) {
				var ev = ev || event;
				var disX = ev.clientX - this.offsetLeft;
				var disY = ev.clientY - this.offsetTop;
				if (oDiv.setCapture) {
					oDiv.setCapture();
				}

				document.onmousemove = function(ev) {
					var ev = ev || event;
					oDiv.style.left = ev.clientX - disX + 'px';
					oDiv.style.top = ev.clientY - disY + 'px';
					socket.emit('IMove', {
						left: oDiv.offsetLeft,
						top : oDiv.offsetTop
					});
				}
				
				document.onmouseup = function() {
					document.onmousemove = null;
					// releaseCapture : 释放全局捕获
					if (oDiv.releaseCapture) {
						oDiv.releaseCapture();
					}
				}
				return false;
			}
		}
	</script>
</body>
</html>
